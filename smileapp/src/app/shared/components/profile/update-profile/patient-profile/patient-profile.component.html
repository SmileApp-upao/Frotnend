<div class="row p-4">
    <div class="div bg-black text-light p-4">
        <div class="row align-items-center p-4">
            <div class="col-md-1 p-0 text-center">
                <img src="https://banffventureforum.com/wp-content/uploads/2019/08/no-photo-icon-22.png" alt="Profile Image" class="img-thumbnail rounded-circle">
            </div>
            <div class="col-md-10">
                <h3 class="ms-3">{{ UserProfile.name }} {{ UserProfile.lastname }}</h3>
            </div>
        </div>
        <div class="row">
            <div class="col-md-1 offset-md-9">
                <button class="btn btn-outline-light" routerLink="/patient">Cancelar</button>
            </div>
            <div class="col-md-2">
                <button class="btn btn-outline-light" (click)="onSubmit()" >Guardar Cambios</button>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-8">
        <div class="row m-4">
            <h1>Sobre mí :</h1>
        </div>
        <form [formGroup]="updateUserForm" (ngSubmit)="onSubmit()">

        <div class="row m-4">
            <div class="col-md-3 ms-4">
                <label class="text-start">Genero</label>
                <select formControlName="gender" class="form-select">
                    <option value="" disabled>Selecciona tu género</option>
                    <option value="Masculino">Masculino</option>
                    <option value="Femenino">Femenino</option>
                </select>
                <div *ngIf="updateUserForm.get('gender')?.invalid && updateUserForm.get('gender')?.touched" class="text-danger">
                    <small>El género es obligatorio.</small>
                </div>
            </div>
            <div class="col-md-4">
                <label class="text-start">Fecha de Nacimiento</label>
                    <input type="date" class="form-control" formControlName="birthday" placeholder="Ingrese su fecha de nacimiento" 
                        [min]="'2000-01-01'" [max]="'2024-12-31'">
                    <div class="alert alert-danger mt-2" *ngIf="updateUserForm.get('birthday')?.invalid && (updateUserForm.get('birthday')?.dirty || updateUserForm.get('birthday')?.touched)">
                        <span *ngIf="updateUserForm.get('birthday')?.errors?.['required']">
                            La fecha de nacimiento es obligatoria.
                        </span>
                    </div>
            </div>
            <div class="col-md-4">
                <label class="text-start">Numero de telefono</label>
                <input type="text" class="form-control" formControlName="phone" placeholder="Ingrese su teléfono">
                    <div class="alert alert-danger mt-2" *ngIf="updateUserForm.get('phone')?.invalid && (updateUserForm.get('phone')?.dirty || updateUserForm.get('phone')?.touched)">
                        <span *ngIf="updateUserForm.get('phone')?.errors?.['required']">
                            El teléfono es obligatorio.
                        </span>
                        <span *ngIf="updateUserForm.get('phone')?.errors?.['minlength'] || updateUserForm.get('phone')?.errors?.['maxlength']">
                            El numero de telefono no puede ser menor o mayor a 9 digitos.
                        </span>
                        <span *ngIf="updateUserForm.get('phone')?.errors?.['pattern']">
                            Introduzca un número de teléfono válido.
                        </span>
                    </div>
            </div>
        </div>
        <div class="row m-4">
            <div class="col-md-3 ms-4">
                <input type="text" formControlName="name" class="form-control" placeholder="Nombre">
                <div *ngIf="updateUserForm.get('name')?.invalid && updateUserForm.get('name')?.touched" class="text-danger">
                    <small>El nombre es obligatorio.</small>
                </div>
            </div>
            <div class="col-md-4">
                <input type="text" formControlName="lastname" class="form-control" placeholder="lastname">
                <div *ngIf="updateUserForm.get('lastname')?.invalid && updateUserForm.get('lastname')?.touched" class="text-danger">
                    <small>El apellido es obligatorio.</small>
                </div>
            </div>
            <div class="col-md-4">
                <input type="email" formControlName="email" class="form-control" placeholder="Email">
                <div *ngIf="updateUserForm.get('email')?.invalid && updateUserForm.get('email')?.touched" class="text-danger">
                    <small>El correo electrónico es obligatorio y debe tener un formato válido.</small>
                </div>
            </div>
        </div>
        </form>
    </div>
    
    <div class="col-md-4">
        <div class="card m-4 center">
            <div class="card-body m-3">
                <h2 class="fw-bold fs-4">Información de emergencia</h2>
                <div *ngIf="existEmercency === true; else anothercase">
                <form [formGroup]="updateUserForm" (ngSubmit)="onSubmit()">
                    <div class="form-group">
                        <label for="parent">Tipo de parentesco</label>
                        <select id="parent" formControlName="parent" class="form-select border border-black" (change)="onRelationshipChange($event)">
                            <option value="" disabled selected>Seleccione el parentesco</option>
                            <option value="Padre">Padre</option>
                            <option value="Madre">Madre</option>
                            <option value="Hermano">Hermano</option>
                            <option value="Hijo">Hijo</option>
                            <option value="Otro">Otro</option>
                        </select>
                    
                        <div *ngIf="updateUserForm.get('parent')?.invalid && updateUserForm.get('parent')?.touched" class="text-danger">
                            <p class="fs-6">El parentesco es requerido.</p>
                        </div>
                    </div>
                    
        
                    <div *ngIf="showOtherRelationship" class="form-group mt-3">
                        <label for="otherRelationship">Especificar parentesco</label>
                        <input type="text" id="otherRelationship" formControlName="otherRelationship" class="form-control border border-black" placeholder="Especifique el parentesco">
                        <div *ngIf="updateUserForm.get('otherRelationship')?.invalid && updateUserForm.get('otherRelationship')?.touched" class="text-danger">
                            <p class="fs-6">Por favor, especifique el parentesco.</p>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="name" class=" mt-3">Nombre</label>
                        <input type="text" id="pname" formControlName="pname" class="form-control border border-black" placeholder="Nombre">
                      </div>
                      <div class="text-danger" *ngIf="updateUserForm.get('pname')?.invalid && updateUserForm.get('pname')?.touched" class="error">
                        <p class="text-danger fs-6">El nombre es requerido</p>
                    </div>
        
                    <div class="form-group">
                        <label for="pdir" class=" mt-3">Dirección</label>
                        <input type="text" id="pdir" formControlName="pdir" class="form-control border border-black" placeholder="Dirección">
                      </div>
                      <div class="text-danger" *ngIf="updateUserForm.get('pdir')?.invalid && updateUserForm.get('pdir')?.touched" class="error">
                        <p class="text-danger fs-6">La Dirección es requerido</p>
                    </div>        
                    <div class="form-group">
                        <label for="pphone" class="mt-3">Teléfono</label>
                        <input
                          type="tel"
                          id="pphone"
                          formControlName="pphone"
                          class="form-control border border-black"
                          placeholder="Teléfono"
                          maxlength="9"      
                          pattern="[0-9]*"     
                          inputmode="numeric"    
                        />
                      </div>
                      <div class="text-danger" *ngIf="updateUserForm.get('pphone')?.invalid && updateUserForm.get('pphone')?.touched">
                        <p class="text-danger fs-6">
                          <span *ngIf="updateUserForm.get('pphone')?.hasError('required')">El teléfono es requerido.</span>
                          <span *ngIf="updateUserForm.get('pphone')?.hasError('pattern')">El teléfono solo debe contener números.</span>
                          <span *ngIf="updateUserForm.get('pphone')?.hasError('minlength') || updateUserForm.get('pphone')?.hasError('maxlength')">
                            El teléfono debe tener exactamente 9 dígitos.
                          </span>
                        </p>
                      </div>
                    </form>
                </div>
                <ng-template #anothercase>
                    <p class="text-danger text-center">No puedes editar estos campos ya que no tienes información de emergencia registrada!</p>
                </ng-template>
            </div>
        </div>
    </div>
</div>